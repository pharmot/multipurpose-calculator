

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Source: amg.js - Multipurpose Calculator Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-custom.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">Documentation</h3>

    

    <h3>Modules</h3><ul><li id="alligation-nav"><a href="module-alligation.html">alligation</a></li><li id="amg-nav"><a href="module-amg.html">amg</a></li><li id="arial-nav"><a href="module-arial.html">arial</a></li><li id="formValidation-nav"><a href="module-formValidation.html">formValidation</a></li><li id="glucommander-nav"><a href="module-glucommander.html">glucommander</a></li><li id="growthCharts-nav"><a href="module-growthCharts.html">growthCharts</a></li><li id="heparin-nav"><a href="module-heparin.html">heparin</a></li><li id="ivFluid-nav"><a href="module-ivFluid.html">ivFluid</a></li><li id="ivig-nav"><a href="module-ivig.html">ivig</a></li><li id="kcentra-nav"><a href="module-kcentra.html">kcentra</a></li><li id="logger-nav"><a href="module-logger.html">logger</a></li><li id="nextdose-nav"><a href="module-nextdose.html">nextdose</a></li><li id="pca-nav"><a href="module-pca.html">pca</a></li><li id="periodicCalc-nav"><a href="module-periodicCalc.html">periodicCalc</a></li><li id="phenytoin-nav"><a href="module-phenytoin.html">phenytoin</a></li><li id="qtc-nav"><a href="module-qtc.html">qtc</a></li><li id="secondDose-nav"><a href="module-secondDose.html">secondDose</a></li><li id="util-nav"><a href="module-util.html">util</a></li><li id="vanco-nav"><a href="module-vanco.html">vanco</a></li><li id="warf-nav"><a href="module-warf.html">warf</a></li></ul><h3>Namespaces</h3><ul><li id="calculate-nav"><a href="calculate.html">calculate</a></li><li id="heparin-nav"><a href="module-heparin-heparin.html">heparin</a></li><li id="kcentra-nav"><a href="module-kcentra-kcentra.html">kcentra</a></li><li id="pt-nav"><a href="pt.html">pt</a></li></ul><h3>Classes</h3><ul><li id="Pca-nav"><a href="module-pca-Pca.html">Pca</a></li><li id="Dose-nav"><a href="module-warf-Dose.html">Dose</a></li><li id="NicuFluidComponent-nav"><a href="NicuFluidComponent.html">NicuFluidComponent</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#changedAmgMethod">changedAmgMethod</a></li><li><a href="global.html#displayChange">displayChange</a></li><li><a href="global.html#MODULE_DELAY">MODULE_DELAY</a></li><li><a href="global.html#resetDates">resetDates</a></li><li><a href="global.html#vancoColorScale">vancoColorScale</a></li></ul><div class="repo-link">
    <svg height="32" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
</svg>
    <a href="https://github.com/pharmot/multipurpose-calculator">Repository</a>
    </div>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        Source: amg.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>/**
 * Aminoglycoside Dosing Module
 * @module amg
 * @since v1.1.0
 * @requires module:util
 * @see [equations.md](https://pharmot.github.io/multipurpose-calculator/equations.md/#aminoglycoside-dosing)
 */
import { addHoursToDate, getHoursBetweenDates, roundTo } from "./util.js";

/**
 * Configuration for aminoglycoside calculations and related input validation.
 * @constant
 * @type     {Object}
 * @default
 * @property {Number}     infTime             assumed infusion time in hours
 * @property {Number}     distTime            assumed distribution time in hours
 * @property {Object}     check               acceptable input values for input validation
 * @property {Number}     check.doseMin       minimum acceptable dose input
 * @property {Number}     check.doseMax       maximum acceptable dose input
 * @property {Number}     check.freqMin       minimum acceptable frequency input
 * @property {Number}     check.freqMax       maximum acceptable frequency input
 * @property {Number}     check.goalPeakMin   minimum acceptable goal peak level input
 * @property {Number}     check.goalPeakMax   maximum acceptable goal peak level
 */
export const config = {
  infTime: 1,
  distTime: 1.7,
  check: {
    goalPeakMin: 1,
    goalPeakMax: 100,
    freqMin: 4,
    freqMax: 96,
    doseMin: 1,
    doseMax: 10000,
    levelMin: 0.001,
    levelMax: 10000,
  },
};

/**
 * Gets the dosing weight for aminoglycoside dosing, per AMG dosing guidelines (2018 version).
 *
 * Return weight of 0 if age &lt;= 15 years (per attachment "B" of aminoglycoside
 * dosing guidelines, use LexiPeds for ages 29 days through 15 years).
 *
 * @param   {DosingWeightParams}  - Dosing weight calculation parameters
 * @returns {DosingWtResults}     - Dosing weight recommendations
 */
export function getDosingWeight({ alt, age, wt, ibw, adjBW, overUnder } = {}) {
  if ( age &lt;= 15 &amp;&amp; age > 0 ) {
    return {
      dosingWeight: 0,
      dosingWeightType: "",
      dosingWeightReason: "Does not apply for age &amp;le; 15",
      dosingWeightString: "Does not apply for age &amp;le; 15",
    };
  }
  if ( ibw === 0 ) {
    return {
      dosingWeight: 0,
      dosingWeightType: "",
      dosingWeightReason: "",
      dosingWeightString: "",
    };
  }
  if ( overUnder > 20 ) {
    return {
      dosingWeight: adjBW,
      dosingWeightType: "adjusted",
      dosingWeightReason: "ABW &amp;gt; 120% of IBW",
      dosingWeightString: `Use adjusted weight: &lt;b>${roundTo( adjBW, 0.1 )} kg&lt;/b>&lt;br>&lt;i>(ABW &amp;gt; 120% of IBW)&lt;/i>`,
    };
  }
  if ( alt ) {
    return {
      dosingWeight: wt,
      dosingWeightType: "actual",
      dosingWeightReason: "non-obese and CF OR pre-/postpartum",
      dosingWeightString: `Use actual weight: &lt;b>${roundTo( wt, 0.1 )} kg&lt;/b>&lt;br>&lt;i>(non-obese and CF OR pre-/postpartum)&lt;/i>`,
    };
  }
  if (  wt &lt; ibw ) {
    return {
      dosingWeight: wt,
      dosingWeightType: "actual",
      dosingWeightReason: "ABW &amp;lt; IBW",
      dosingWeightString: `Use actual weight: &lt;b>${roundTo( wt, 0.1 )} kg&lt;/b>&lt;br>&lt;i>(ABW &amp;lt; IBW)&lt;/i>`,
    };
  }
  return {
    dosingWeight: ibw,
    dosingWeightType: "ideal",
    dosingWeightReason: "ABW &amp;lt; 120% of IBW",
    dosingWeightString: `Use ideal weight: &lt;b>${roundTo( ibw, 0.1 )} kg&lt;/b>&lt;br>&lt;i>(ABW &amp;lt; 120% of IBW)&lt;/i>`,
  };
}

/**
 * Gets the goal trough level
 * @since v1.2.0
 *
 * @param   {String} drug - The selected drug, as a single uppercase letter: [G]entamicin, [T]obramycin, or [A]mikacin
 * @returns {Number}      - The goal trough, in mcg/mL
 */
function getGoalTrough( drug ) {
  if ( drug === "A" ) return 4;
  return 2;
}

/**
 * Rounds the dose with factor based on drug
 * @since v1.2.0
 *
 * @param   {Number} dose - The dose to be rounded
 * @param   {String} drug - The selected drug, as a single uppercase letter: [G]entamicin, [T]obramycin, or [A]mikacin
 * @returns {Number}      - The goal trough, in mcg/mL
 */
export function roundDose( dose, drug ) {
  if ( drug === "A" ) return roundTo( dose, 50 );
  return roundTo( dose, 10 );
}

/**
 * Calculate extended interval kinetics
 * @since v1.2.0
 *
 * @param   {AmgParams}             - Input parameters
 * @returns {AmgExtendedResult}     - Results
 */
export function extended({ drug, goalPeak, dose, doseTime, postAbxEffect, level1, level1Time, level2, level2Time, customTime, valid = true } = {}) {

  const goalTrough = getGoalTrough( drug );


  if ( valid &amp;&amp; level1Time > 0 &amp;&amp; level2Time > 0 &amp;&amp; doseTime > 0 &amp;&amp; level1 > 0 &amp;&amp; level2 > 0 &amp;&amp; dose > 0 &amp;&amp; goalPeak > 0 ) {


    //  ┌──tpOffset──┬───2.7───┐        ┌─────────TTR──────────┐
    // dose      truePeak   level1    level2     trough      redose
    //      warn               └────ke──┴────TTT────┴───PAE────┘
    //  └─2.7─┘
    const ke = Math.log( level1 / level2 ) / getHoursBetweenDates( level1Time, level2Time );
    const truePeakOffset = getHoursBetweenDates( doseTime, level1Time ) - ( config.infTime + config.distTime );
    const truePeak = level1 / Math.exp( -truePeakOffset * ke );
    const timeToTrough = Math.log( goalTrough / level2 ) / -ke;
    const troughDT = addHoursToDate( level2Time, timeToTrough );
    const redoseDT = addHoursToDate( troughDT, postAbxEffect );
    const timeToRedose = timeToTrough + postAbxEffect;
    const redoseLevel = Math.exp( -ke * timeToRedose ) * level2;
    const peakToTroughTime = Math.log( goalTrough / goalPeak ) / -ke;
    const newDoseToRedoseTime = peakToTroughTime + postAbxEffect + ( config.infTime + config.distTime );
    const vd = +( dose / truePeak );
    const recDose = goalPeak / truePeak * dose;
    const recDoseRounded = roundDose( recDose, drug );
    const recFreq = roundTo( newDoseToRedoseTime, 12 );
    const warnTime = addHoursToDate( doseTime,  config.infTime + config.distTime  );

    const levelAtCustom =  customTime > 0 &amp;&amp; customTime > level1Time  ? Math.exp( -ke * getHoursBetweenDates( level2Time,  customTime ) ) * level2 : undefined;

    const warn = warnTime > level1Time;

    return { goalTrough, ke, truePeak, troughDT, redoseDT, redoseLevel, newDoseToRedoseTime, vd, recDose, recFreq, levelAtCustom, recDoseRounded, warn };

  }
  return {
    goalTrough: goalTrough,
    ke: 0,
    truePeak: 0,
    troughDT: 0,
    redoseDT: 0,
    redoseLevel: undefined,
    newDoseToRedoseTime: 0,
    vd: 0,
    recDose: 0,
    recDoseRounded: 0,
    recFreq: 0,
    levelAtCustom: undefined,
    warn: false,
  };
}

/**
 * Calculate kinetics for CF dosing
 * @since v1.2.0
 *
 * @param   {AmgParams}       - Input parameters
 * @returns {AmgCfResult}     - Results
 */
export function cf({ drug, freq, doseTime, level1,  level1Time, level2, level2Time } = {}) {

  const goalTrough = "Undetectable";
  const goalPeak = drug === "A" ? "35-50 mcg/mL" : "20-30 mcg/mL";
  const goalAuc = drug === "T" &amp;&amp; freq === 24  ? "&amp;lt; 101 mg&amp;middot;hr/L" : "n/a";

  if ( level1Time &lt; level2Time &amp;&amp; doseTime &lt; level1Time &amp;&amp; level1Time !== 0 &amp;&amp; level2Time !== 0 &amp;&amp; doseTime !== 0 &amp;&amp; level1 !== 0 &amp;&amp; level2 !== 0 &amp;&amp; freq !== 0 ) {
    const timeBetweenLevels = getHoursBetweenDates( level1Time, level2Time );
    const timeToLevel1 = getHoursBetweenDates( doseTime, level1Time );
    const timeToLevel2 = getHoursBetweenDates( doseTime, level2Time );
    const ke = Math.log( level1 / level2 ) / timeBetweenLevels;
    const predPeak = level1 / Math.exp( -ke * ( timeToLevel1 - config.infTime ) );
    const predTrough = level2 * Math.exp( -ke * ( freq - timeToLevel2 ) );
    const auc = ( predPeak - predTrough ) / ke;
    const halflife = 0.693 / ke;
    return { goalTrough, goalPeak, goalAuc, ke, predPeak, predTrough, auc, halflife };
  } else {
    return {
      goalTrough: goalTrough,
      goalPeak: goalPeak,
      goalAuc: goalAuc,
      ke: 0,
      predPeak: 0,
      predTrough: 0,
      auc: 0,
      halflife: 0,
    };
  }
}
/**
 * Parameters for calculating AMG dosing weight
 *
 * @typedef  {Object}  DosingWeightParams
 * @property {Boolean} alt       Use alternate dosing weight
 * @property {Number}  age       Patient age in years
 * @property {Number}  wt        Patient weight in kg
 * @property {Number}  ibw       Ideal body weight in kg
 * @property {Number}  adjBW     Adjusted body weight in kg
 * @property {Number}  overUnder Percent over or under ideal body weight
 */
/**
 * Aminoglycoside Cystic Fibrosis Calculation Results
 *
 * @typedef  {Object}
 * @property {String} goalTrough - Goal trough
 * @property {String} goalPeak   - Goal peak, with units
 * @property {String} goalAuc    - Goal AUC, with units
 * @property {Number} ke         - Elimination rate constant in 1/hr
 * @property {Number} predPeak   - Predicted peak in mcg/mL
 * @property {Number} predTrough - Predicted trough in mcg/mL
 * @property {Number} auc        - AUC in mg·hr/L
 * @property {Number} halflife   - Halflife in hours
 */
/**
 * Aminoglycoside Calculation Parameters
 *
 * @typedef  {Object}  AmgParams
 * @property {String}  drug          - The selected drug, as a single uppercase letter: [G]entamicin, [T]obramycin, or [A]mikacin
 * @property {Number}  goalPeak      - Goal peak level in mcg/mL
 * @property {Number}  dose          - Current dose in mg
 * @property {Date}    doseTime      - Date and time of dose
 * @property {Number}  postAbxEffect - Post antibiotic effect, in hours
 * @property {Number}  level1        - First level in mcg/mL
 * @property {Date}    level1Time    - Date and time of first level
 * @property {Number}  level2        - Second level in mcg/mL
 * @property {Date}    level12ime    - Date and time of second level
 * @property {Date}    customTime    - Date and time for custom estimation
 */
/**
 * Aminoglycoside Extended Interval Calculation Results
 *
 * @typedef  {Object}  AmgExtendedResult
 * @property {Number}  ke                     - Elinimation rate constant in (1/hr), or 0 if insufficient inputs
 * @property {Number}  truePeak               - True peak level in mcg/mL, or 0 if insufficient inputs     
 * @property {Date}    troughDT               - Date and time of goal trough/target MIC, or 0 if insufficient inputs
 * @property {Date}    redoseDT               - Date and time of redose point, or 0 if insufficient inputs
 * @property {Number}  redoseLevel            - Estimated level at redose point, or undefined if insufficient inputs
 * @property {Date}    newDoseToRedoseTime    - Time from start of new dose to redose point, or 0 if insufficient inputs
 * @property {Number}  vd                     - Volume of distribution, or 0 if insufficient inputs
 * @property {Number}  recDose                - Recommended new dose in mg, or 0 if insufficient inputs
 * @property {Number}  recFreq                - Recommended new frequency to the nearest 12 hours, or 0 if insufficient inputs
 * @property {Number}  levelAtCustom          - Estimated level at custom date and time, or undefined if insufficient inputs
 * @property {Boolean} warn                   - Show warning that distribution may not be complete
 * @property {Boolean} [valid=true]           - Set to false if inputs already known to be invalid
 */
/**
 * Results from AMG dosing weight calculations
 *
 * @typedef  {Object} DosingWtResults
 * @property {Number} dosingWeight       Dosing weight in kg
 * @property {String} dosingWeightType   Weight type
 * @property {String} dosingWeightReason Reason for using specified weight
 * @property {String} dosingWeightString Full HTML string for display
 */</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
